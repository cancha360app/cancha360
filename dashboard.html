```html
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard</title>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { margin-top: 30px; }
    .card {
      border: 1px solid #ccc; border-radius: 8px; padding: 10px;
      margin: 10px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .card button { margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Dashboard</h1>
  <p id="usuario"></p>

  <h2>Mis Partidos</h2>
  <div id="mis-partidos"></div>

  <h2>Partidos Disponibles</h2>
  <div id="partidos-disponibles"></div>

  <script>
    // Configura tu cliente Supabase
    const SUPABASE_URL = "https://TU-PROJECT.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJjcHd5cHF6YWhzZnN1ZGxrd2FmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg5MTQwODIsImV4cCI6MjA3NDQ5MDA4Mn0.VPkdTAhTK_tZ6Re_lcdx5E3oxSDS2oYG8YDSATXtcl4";
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    let currentUser = null;

    // Verificar sesión
    async function checkUser() {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        window.location.href = "login.html";
        return;
      }
      currentUser = user;
      document.getElementById("usuario").textContent = "Usuario actual: " + currentUser.id;
      console.log("Usuario actual:", currentUser.id);

      loadReservas();
      loadPartidosDisponibles();
    }

    // Cargar partidos en los que ya estoy
    async function loadReservas() {
      const { data: reservas, error } = await supabase
        .from("reservas")
        .select("*, reservas_usuarios(usuario_id)")
        .eq("reservas_usuarios.usuario_id", currentUser.id);

      if (error) {
        console.error("Error cargando reservas:", error);
        return;
      }

      console.log("Mis reservas:", reservas);

      const contenedor = document.getElementById("mis-partidos");
      contenedor.innerHTML = "";

      reservas.forEach(r => {
        const item = document.createElement("div");
        item.className = "card";
        item.innerHTML = `
          <strong>Partido #${r.id}</strong><br>
          Fecha: ${r.fecha} - ${r.hora_inicio} a ${r.hora_fin}<br>
          Cupo: ${r.cupo_actual} / ${r.cupo_max}
        `;
        contenedor.appendChild(item);
      });
    }

    // Cargar partidos disponibles
    async function loadPartidosDisponibles() {
      const { data: reservas, error } = await supabase
        .from("reservas")
        .select("*, reservas_usuarios(usuario_id)");

      if (error) {
        console.error("Error cargando partidos:", error);
        return;
      }

      console.log("Reservas encontradas:", reservas);

      // Obtener IDs de partidos en los que ya estoy
      const misPartidos = reservas
        .filter(r => r.reservas_usuarios.some(u => u.usuario_id === currentUser.id))
        .map(r => r.id);

      console.log("Partidos en los que ya estoy:", misPartidos);

      // Filtrar disponibles: no soy creador, no estoy ya inscrito
      const disponibles = reservas.filter(r =>
        r.usuario_id !== currentUser.id &&
        !misPartidos.includes(r.id) &&
        r.cupo_actual < r.cupo_max
      );

      console.log("Partidos disponibles filtrados:", disponibles);

      const contenedor = document.getElementById("partidos-disponibles");
      contenedor.innerHTML = "";

      disponibles.forEach(r => {
        const item = document.createElement("div");
        item.className = "card";
        item.innerHTML = `
          <strong>Partido #${r.id}</strong><br>
          Fecha: ${r.fecha} - ${r.hora_inicio} a ${r.hora_fin}<br>
          Cupo: ${r.cupo_actual} / ${r.cupo_max}<br>
          <button>Unirme</button>
        `;

        item.querySelector("button").addEventListener("click", async () => {
          // Insertar en reservas_usuarios
          const { error: insertError } = await supabase
            .from("reservas_usuarios")
            .insert([{ reserva_id: r.id, usuario_id: currentUser.id }]);

          if (insertError) {
            alert("❌ Error al unirse: " + insertError.message);
            return;
          }

          // Incrementar cupo usando función RPC
          console.log("Llamando RPC incrementar_cupo para reserva", r.id);
          const { data, error: fnError } = await supabase.rpc("incrementar_cupo", { id_reserva: r.id });
          console.log("Respuesta RPC:", data, fnError);

          if (fnError) {
            alert("❌ Error al actualizar cupo: " + fnError.message);
            return;
          }

          alert("✅ Te uniste al partido");
          loadPartidosDisponibles();
          loadReservas();
        });

        contenedor.appendChild(item);
      });
    }

    checkUser();
  </script>
</body>
</html>
```
